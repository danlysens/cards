<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarDex üèéÔ∏è</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- –°–¢–ò–õ–ò (CSS) --- */
        body { font-family: 'Roboto', sans-serif; background: #222; color: white; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
        
        /* –≠–∫—Ä–∞–Ω –∫–∞–º–µ—Ä—ã */
        #camera-screen { flex: 1; position: relative; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; background: #000; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; z-index: 1; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
        .overlay { position: relative; z-index: 2; width: 100%; padding-bottom: 20px; display: flex; justify-content: center; align-items: center; background: linear-gradient(transparent, rgba(0,0,0,0.8)); }
        
        #scan-btn {
            width: 80px; height: 80px;
            border-radius: 50%;
            border: 5px solid white;
            background: rgba(255, 50, 50, 0.8);
            box-shadow: 0 0 15px rgba(255, 50, 50, 0.6);
            cursor: pointer;
            transition: transform 0.1s;
        }
        #scan-btn:active { transform: scale(0.9); }

        /* –≠–∫—Ä–∞–Ω –∫–æ–ª–ª–µ–∫—Ü–∏–∏ */
        #collection-screen { display: none; background: #f5f5f5; color: #333; height: 100%; overflow-y: auto; padding: 20px; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card { background: white; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); overflow: hidden; display: flex; }
        .card img { width: 100px; height: 80px; object-fit: cover; }
        .card-info { padding: 10px; display: flex; flex-direction: column; justify-content: center; }
        .card-title { font-weight: bold; font-size: 1.1em; }
        .card-date { font-size: 0.8em; color: #888; }
        
        .nav-btn { padding: 10px 20px; background: #333; color: white; border: none; border-radius: 5px; cursor: pointer; }

        /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è */
        .scanner-line {
            position: absolute; top: 0; left: 0; width: 100%; height: 2px;
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
            z-index: 3;
            animation: scanAnim 2s infinite linear;
            display: none;
        }
        @keyframes scanAnim {
            0% { top: 0%; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
    </style>
</head>
<body>

    <div id="camera-screen">
        <video id="video" autoplay playsinline></video>
        <div class="scanner-line" id="scanner-line"></div>
        <canvas id="canvas" style="display:none;"></canvas>
        
        <div class="overlay">
            <div style="position: absolute; left: 20px; bottom: 35px;">
                <button onclick="showCollection()" class="nav-btn">üèÜ –ì–∞—Ä–∞–∂</button>
            </div>
            <button id="scan-btn" onclick="captureAndScan()"></button>
        </div>
    </div>

    <div id="collection-screen">
        <div class="header">
            <h2>–ú–æ–π –ì–∞—Ä–∞–∂ (<span id="count">0</span>)</h2>
            <button onclick="showCamera()" class="nav-btn">üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
        <div id="list">
            </div>
    </div>

    <script>
        // --- 1. –ù–ê–°–¢–†–û–ô–ö–ê –ö–ê–ú–ï–†–´ ---
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        
        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∑–∞–¥–Ω—é—é –∫–∞–º–µ—Ä—É –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ
                });
                video.srcObject = stream;
            } catch (err) {
                alert("–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ! –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –≤ –±—Ä–∞—É–∑–µ—Ä–µ.");
            }
        }
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–∞–º–µ—Ä—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        startCamera();

        // --- 2. –õ–û–ì–ò–ö–ê "–ò–°–ö–£–°–°–¢–í–ï–ù–ù–û–ì–û –ò–ù–¢–ï–õ–õ–ï–ö–¢–ê" ---
        // –ü–æ—Å–∫–æ–ª—å–∫—É –Ω–∞ Github Pages –Ω–µ–ª—å–∑—è –ø–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ª–æ–∂–Ω—ã–π Python,
        // –º—ã –∏–º–∏—Ç–∏—Ä—É–µ–º —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –¥–ª—è –ø—Ä–æ—Ç–æ—Ç–∏–ø–∞.
        // (–ù–∏–∂–µ —è –æ–±—ä—è—Å–Ω—é, –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–π TF.js)
        
        const carDatabase = [
            "BMW M5 Competition", "Audi RS6 Avant", "Mercedes-AMG G63",
            "Porsche 911 Turbo S", "Lamborghini Huracan", "Toyota Supra MK4",
            "Nissan GTR R35", "Ford Mustang Shelby", "Dodge Challenger",
            "Tesla Model S Plaid", "Lada Niva Legend"
        ];

        function mockAI_Identify() {
            // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—É—é –º–∞—à–∏–Ω—É –∏–∑ —Å–ø–∏—Å–∫–∞
            const randomCar = carDatabase[Math.floor(Math.random() * carDatabase.length)];
            const accuracy = (Math.random() * (99 - 85) + 85).toFixed(1); // –°–ª—É—á–∞–π–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å
            return { model: randomCar, accuracy: accuracy };
        }

        // --- 3. –§–£–ù–ö–¶–ò–ò –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø ---

        function captureAndScan() {
            // –≠—Ñ—Ñ–µ–∫—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
            document.getElementById('scanner-line').style.display = 'block';
            
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è —Ä–µ–∞–ª–∏–∑–º–∞
            setTimeout(() => {
                // –î–µ–ª–∞–µ–º —Å–Ω–∏–º–æ–∫
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                canvas.getContext('2d').drawImage(video, 0, 0);
                const imageData = canvas.toDataURL('image/jpeg'); // –§–æ—Ç–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64
                
                // "–†–∞—Å–ø–æ–∑–Ω–∞–µ–º"
                const result = mockAI_Identify();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º
                saveCar(result.model, imageData);
                
                document.getElementById('scanner-line').style.display = 'none';
                alert(`üéØ –ù–∞–π–¥–µ–Ω–æ: ${result.model}\n–¢–æ—á–Ω–æ—Å—Ç—å: ${result.accuracy}%`);
                showCollection();
            }, 1500);
        }

        function saveCar(model, image) {
            let garage = JSON.parse(localStorage.getItem('myCars')) || [];
            
            const newCar = {
                id: Date.now(),
                model: model,
                image: image,
                date: new Date().toLocaleDateString()
            };
            
            garage.push(newCar);
            localStorage.setItem('myCars', JSON.stringify(garage));
            renderGallery();
        }

        function renderGallery() {
            const list = document.getElementById('list');
            const garage = JSON.parse(localStorage.getItem('myCars')) || [];
            document.getElementById('count').innerText = garage.length;
            
            list.innerHTML = '';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É (reverse)
            garage.reverse().forEach(car => {
                const item = `
                    <div class="card">
                        <img src="${car.image}" alt="car">
                        <div class="card-info">
                            <div class="card-title">${car.model}</div>
                            <div class="card-date">–ü–æ–π–º–∞–Ω–∞: ${car.date}</div>
                        </div>
                    </div>
                `;
                list.innerHTML += item;
            });
        }

        // --- 4. –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–ï –≠–ö–†–ê–ù–û–í ---
        function showCollection() {
            renderGallery();
            document.getElementById('camera-screen').style.display = 'none';
            document.getElementById('collection-screen').style.display = 'block';
        }

        function showCamera() {
            document.getElementById('collection-screen').style.display = 'none';
            document.getElementById('camera-screen').style.display = 'flex';
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –≥–∞–ª–µ—Ä–µ–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        renderGallery();

    </script>
</body>
</html>
